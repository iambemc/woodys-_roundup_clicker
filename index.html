<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Woody's Roundup Clicker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bangers&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Bangers', cursive;
            background-color: #72b1f0; /* Andy's Room Blue Sky */
            background-image: 
                radial-gradient(white 15%, transparent 16%),
                radial-gradient(white 15%, transparent 16%);
            background-size: 80px 80px;
            background-position: 0 0, 40px 40px;
            color: #fde047; /* Toy Story Yellow */
            touch-action: manipulation;
            overflow: hidden;
        }
        canvas {
            background-color: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(2px);
            cursor: none;
            border-radius: 1rem;
            border: 4px solid #fde047;
        }
        .text-shadow-custom {
            text-shadow: 2px 2px #dc2626, 4px 4px #1d4ed8; /* Red and Blue Shadow */
        }
        .modal {
            background-color: rgba(29, 78, 216, 0.8); /* Blue with opacity */
            backdrop-filter: blur(8px);
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4">

    <main id="game-container" class="w-full max-w-4xl mx-auto flex flex-col items-center">
        <h1 class="text-4xl text-center sm:text-6xl text-shadow-custom mb-4">Woody's Roundup Clicker</h1>
        
        <div class="w-full grid grid-cols-3 items-center bg-blue-800/70 border-2 border-yellow-300 rounded-lg p-2 sm:p-4 mb-4">
            <div class="text-center">
                <span class="text-xl sm:text-2xl text-red-500">Score</span>
                <p id="score" class="text-3xl sm:text-5xl">0</p>
            </div>
            <div class="text-center">
                 <span class="text-xl sm:text-2xl text-red-500">High Score</span>
                <p id="high-score" class="text-3xl sm:text-5xl">0</p>
            </div>
            <div class="text-center">
                <span class="text-xl sm:text-2xl text-red-500">Time</span>
                <p id="timer" class="text-3xl sm:text-5xl">60</p>
            </div>
        </div>
        <button id="mute-button" class="absolute top-5 right-5 text-yellow-300 hover:text-white transition-colors z-10">
            <svg id="icon-unmuted" xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
            <svg id="icon-muted" xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hidden"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><line x1="23" y1="9" x2="17" y2="15"></line><line x1="17" y1="9" x2="23" y2="15"></line></svg>
        </button>

        <canvas id="gameCanvas"></canvas>
    </main>

    <!-- Start/End Modal -->
    <div id="modal" class="absolute inset-0 modal flex items-center justify-center">
        <div class="bg-yellow-100 border-4 border-yellow-300 rounded-2xl p-8 text-center shadow-2xl">
            <h2 id="modal-title" class="text-6xl text-shadow-custom text-blue-800 mb-4">Howdy Partner!</h2>
            <p id="modal-text" class="text-2xl text-red-600 mb-6">Click the targets before time runs out!</p>
            <button id="modal-button" class="bg-red-600 hover:bg-red-700 text-yellow-200 font-bold py-3 px-12 rounded-lg shadow-lg text-4xl transition-transform transform hover:scale-110">Start Game</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const scoreEl = document.getElementById('score');
            const timerEl = document.getElementById('timer');
            const highScoreEl = document.getElementById('high-score');
            const modal = document.getElementById('modal');
            const modalTitle = document.getElementById('modal-title');
            const modalText = document.getElementById('modal-text');
            const modalButton = document.getElementById('modal-button');
            const muteButton = document.getElementById('mute-button');
            const iconMuted = document.getElementById('icon-muted');
            const iconUnmuted = document.getElementById('icon-unmuted');

            let score = 0, timeLeft = 60, targets = [], effects = [], crosshair = { x: 0, y: 0 };
            let gameLoopId, timerId, targetSpawnIntervalId;
            let soundsReady = false, isMuted = false;

            // --- Audio Setup ---
            const sounds = {
                shoot: () => new Tone.NoiseSynth({ noise: { type: 'pink' }, envelope: { attack: 0.001, decay: 0.05, sustain: 0, release: 0.1 } }).toDestination().triggerAttackRelease("16n"),
                hit: () => new Tone.PluckSynth().toDestination().triggerAttackRelease('C5', '8n'),
                end: () => new Tone.Synth().toDestination().triggerAttackRelease('G3', '4n')
            };
            const musicSynth = new Tone.Synth({ oscillator: { type: 'pulse', width: 0.3 }, envelope: { attack: 0.01, decay: 0.2, sustain: 0.2, release: 0.1 } }).toDestination();
            musicSynth.volume.value = -15;
            const musicMelody = [ 'C4', 'E4', 'G4', 'E4', 'C4', 'E4', 'G4', null, 'A4', 'G4', 'F4', 'E4', 'D4', null, 'C4', null ];
            const musicLoop = new Tone.Sequence((time, note) => { if (note) { musicSynth.triggerAttackRelease(note, '8n', time); } }, musicMelody, '8n');
            
            // --- Target Drawing Functions ---
            const targetTypes = [
                (x, y, radius, color) => { /* star */ ctx.fillStyle = '#FFD700'; ctx.strokeStyle = '#8B4513'; ctx.lineWidth = 3; ctx.beginPath(); for (let i = 0; i < 10; i++) { const angle = (i * 2 * Math.PI) / 10 - Math.PI / 2; const r = i % 2 === 0 ? radius : radius * 0.5; ctx.lineTo(x + r * Math.cos(angle), y + r * Math.sin(angle)); } ctx.closePath(); ctx.fill(); ctx.stroke(); },
                (x, y, radius, color) => { /* ball */ ctx.fillStyle = '#FFD900'; ctx.beginPath(); ctx.arc(x, y, radius, 0, Math.PI * 2); ctx.fill(); ctx.fillStyle = '#4A90E2'; ctx.fillRect(x - radius, y - radius * 0.2, radius * 2, radius * 0.4); ctx.fillStyle = '#E40D23'; const starSize = radius * 0.5; ctx.beginPath(); ctx.moveTo(x, y - starSize); for (let i = 0; i < 5; i++) { ctx.lineTo(x + Math.cos((18 + i * 72) / 180 * Math.PI) * starSize, y - Math.sin((18 + i * 72) / 180 * Math.PI) * starSize); ctx.lineTo(x + Math.cos((54 + i * 72) / 180 * Math.PI) * starSize * 0.5, y - Math.sin((54 + i * 72) / 180 * Math.PI) * starSize * 0.5); } ctx.closePath(); ctx.fill(); },
                (x, y, radius, color) => { /* balloon */ ctx.fillStyle = color; ctx.strokeStyle = 'rgba(0,0,0,0.5)'; ctx.lineWidth = 2; ctx.beginPath(); ctx.ellipse(x, y, radius * 0.8, radius, 0, 0, Math.PI * 2); ctx.fill(); ctx.stroke(); ctx.beginPath(); ctx.moveTo(x - radius * 0.1, y + radius); ctx.lineTo(x + radius * 0.1, y + radius); ctx.lineTo(x, y + radius + 10); ctx.closePath(); ctx.fill(); }
            ];

            function resizeCanvas() {
                const container = document.getElementById('game-container');
                const width = container.offsetWidth;
                canvas.width = width;
                canvas.height = width * 0.6;
            }
            window.addEventListener('resize', resizeCanvas);
            
            function createTarget() {
                const radius = Math.random() * 25 + 20;
                const x = Math.random() < 0.5 ? -radius : canvas.width + radius;
                const y = Math.random() * (canvas.height - radius * 2) + radius;
                const angle = x > canvas.width ? Math.PI : 0;
                const speed = Math.random() * 2.5 + 1.5;
                const dx = Math.cos(angle) * speed;
                const dy = (Math.random() - 0.5) * 1.5; 
                const type = Math.floor(Math.random() * targetTypes.length);
                const color = `hsl(${Math.random() * 360}, 90%, 70%)`;
                targets.push({ x, y, dx, dy, radius, type, color });
            }
            
            function createHitEffect(x, y) {
                for (let i = 0; i < 10; i++) {
                    effects.push({
                        x, y,
                        dx: (Math.random() - 0.5) * 5,
                        dy: (Math.random() - 0.5) * 5,
                        size: Math.random() * 5 + 2,
                        life: 30
                    });
                }
            }

            function gameLoop() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                targets.forEach((target, index) => {
                    target.x += target.dx;
                    target.y += target.dy;
                    if (target.x + target.radius < -50 || target.x - target.radius > canvas.width + 50) {
                        targets.splice(index, 1);
                    }
                    targetTypes[target.type](target.x, target.y, target.radius, target.color);
                });
                
                effects.forEach((effect, index) => {
                    effect.x += effect.dx;
                    effect.y += effect.dy;
                    effect.life--;
                    if(effect.life <= 0) {
                        effects.splice(index, 1);
                    }
                    ctx.fillStyle = '#FFD700';
                    ctx.beginPath();
                    ctx.arc(effect.x, effect.y, effect.size * (effect.life / 30), 0, Math.PI * 2);
                    ctx.fill();
                });

                // Draw crosshair
                ctx.strokeStyle = '#dc2626';
                ctx.lineWidth = 4;
                ctx.beginPath();
                const radius = 20;
                 for (let i = 0; i < 10; i++) {
                    const angle = (i * 2 * Math.PI) / 10 - Math.PI / 2;
                    const r = i % 2 === 0 ? radius : radius * 0.5;
                    ctx.lineTo(crosshair.x + r * Math.cos(angle), crosshair.y + r * Math.sin(angle));
                }
                ctx.closePath();
                ctx.stroke();

                gameLoopId = requestAnimationFrame(gameLoop);
            }

            function shoot(e) {
                if (!soundsReady) { initAudio(); }
                sounds.shoot();
                
                for (let i = targets.length - 1; i >= 0; i--) {
                    const target = targets[i];
                    const dist = Math.hypot(crosshair.x - target.x, crosshair.y - target.y);
                    if (dist - target.radius < 1) {
                        sounds.hit();
                        score += Math.ceil(50 / target.radius);
                        scoreEl.textContent = score;
                        createHitEffect(target.x, target.y);
                        targets.splice(i, 1);
                        break; 
                    }
                }
            }

            function updateCrosshair(e) {
                const rect = canvas.getBoundingClientRect();
                crosshair.x = e.clientX - rect.left;
                crosshair.y = e.clientY - rect.top;
            }
            
            function initAudio() {
                 if (!soundsReady) { Tone.start(); soundsReady = true; }
            }

            function startGame() {
                initAudio();
                modal.style.display = 'none';
                score = 0;
                timeLeft = 60;
                targets = [];
                effects = [];
                scoreEl.textContent = score;
                timerEl.textContent = timeLeft;
                canvas.addEventListener('mousemove', updateCrosshair);
                canvas.addEventListener('click', shoot);
                gameLoopId = requestAnimationFrame(gameLoop);
                targetSpawnIntervalId = setInterval(createTarget, 800);
                Tone.Transport.start();
                musicLoop.start(0);
                timerId = setInterval(() => {
                    timeLeft--;
                    timerEl.textContent = timeLeft;
                    if (timeLeft <= 0) { endGame(); }
                }, 1000);
            }

            function endGame() {
                sounds.end();
                cancelAnimationFrame(gameLoopId);
                clearInterval(timerId);
                clearInterval(targetSpawnIntervalId);
                canvas.removeEventListener('mousemove', updateCrosshair);
                canvas.removeEventListener('click', shoot);
                Tone.Transport.stop();
                musicLoop.stop(0);
                
                const highScore = getHighScore();
                if(score > highScore) {
                    saveHighScore(score);
                    displayHighScore();
                    modalTitle.textContent = 'New High Score!';
                    modalText.textContent = `You set a new record of ${score}!`;
                } else {
                    modalTitle.textContent = 'Game Over!';
                    modalText.textContent = `Your final score is ${score}!`;
                }
                modalButton.textContent = 'Play Again';
                modal.style.display = 'flex';
            }
            
            function toggleMute() {
                initAudio();
                isMuted = !isMuted;
                Tone.Destination.mute = isMuted;
                iconMuted.classList.toggle('hidden', !isMuted);
                iconUnmuted.classList.toggle('hidden', isMuted);
            }
            
            function getHighScore() { return parseInt(localStorage.getItem('roundupHighScore') || '0'); }
            function saveHighScore(newScore) { localStorage.setItem('roundupHighScore', newScore); }
            function displayHighScore() { highScoreEl.textContent = getHighScore(); }

            modalButton.addEventListener('click', startGame);
            muteButton.addEventListener('click', toggleMute);
            
            // Initial Setup
            resizeCanvas();
            displayHighScore();
        });
    </script>
</body>
</html>

